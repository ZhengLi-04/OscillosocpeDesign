C51 COMPILER V9.54   MODE                                                                  04/02/2025 12:15:33 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MODE
OBJECT MODULE PLACED IN .\Objects\mode.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE mode.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\mode
                    -.lst) TABS(2) OBJECT(.\Objects\mode.obj)

line level    source

   1          /* mode.c */
   2          #include <reg51.h>
   3          #include <math.h>
   4          
   5          #include "mode.h"
   6          #include "global.h"
   7          #include "led.h"
   8          
   9          // 模式3显示状态机
  10          typedef enum
  11          {
  12              MODE3_INIT,     // 初始提示
  13              MODE3_FREQ,     // 显示频率
  14              MODE3_VOLT      // 显示电压
  15          } Mode3State;
  16          
  17          
  18          static Mode3State mode3State = MODE3_INIT;
  19          static unsigned long mode3Timer = 0;
  20          
  21          void Mode1_Process(void)
  22          {
  23   1          fdisp(22, 0);
  24   1          fdisp(1, 1);
  25   1          fdisp(22, 2);
  26   1          fdisp(22, 3);
  27   1      }
  28          
  29          void Mode2_Process(void)
  30          {
  31   1          fdisp(22, 0);
  32   1          fdisp(2, 1);
  33   1          fdisp(22, 2);
  34   1          fdisp(22, 3);
  35   1      }
  36          
  37          
  38          void Mode3_Process(void)
  39          {
  40   1          // 调用测量函数（在中断中周期性执行）
  41   1          //ampMeasure();
  42   1          //freMeasure();
  43   1      
  44   1      
  45   1          switch (mode3State)
  46   1          {
  47   2          case MODE3_INIT:  
  48   2              fdisp(22, 0);  // "-"
  49   2              fdisp(3, 1);    // "3"
  50   2              fdisp(22, 2);   // "-"
  51   2              fdisp(22, 3);   // "-"
  52   2      
  53   2              if (clocktime - mode3Timer >= 200)   // ?1?(??clocktime?5ms??)
  54   2              {
C51 COMPILER V9.54   MODE                                                                  04/02/2025 12:15:33 PAGE 2   

  55   3                  mode3State = MODE3_FREQ;
  56   3                  mode3Timer = clocktime;
  57   3              }
  58   2              break;
  59   2      
  60   2          case MODE3_FREQ:   // ????
  61   2              UpdateFrequencyDisplay(freq);
  62   2              if (clocktime - mode3Timer >= 400)   // 2???
  63   2              {
  64   3                  mode3State = MODE3_VOLT;
  65   3                  mode3Timer = clocktime;
  66   3              }
  67   2              break;
  68   2      
  69   2          case MODE3_VOLT:   // ????
  70   2              UpdateVoltageDisplay(vpp);
  71   2              if (clocktime - mode3Timer >= 400)
  72   2              {
  73   3                  mode3State = MODE3_FREQ;
  74   3                  mode3Timer = clocktime;
  75   3              }
  76   2              break;
  77   2          }
  78   1      }
  79          
  80          void ResetMode3State(void) {
  81   1          mode3State = MODE3_INIT;
  82   1          mode3Timer = clocktime; 
  83   1      }
  84          
  85          // ????(??:FXXX)
  86          void UpdateFrequencyDisplay(int freq)
  87          {
  88   1          fdisp(21, 0);  // ??"F"
  89   1      
  90   1          freq = (freq > 999) ? 999 : freq;  // ??
  91   1          fdisp((freq / 100) % 10, 1); // ??
  92   1          fdisp((freq / 10) % 10, 2); // ??
  93   1          fdisp((freq / 1) % 10, 3); // ??
  94   1      }
  95          
  96          // ????(??:UXX.X)
  97          void UpdateVoltageDisplay(float vpp)
  98          {
  99   1          int value = (int)(vpp * 10);
 100   1      
 101   1          fdisp(20, 0);  // ???"U"??(???3????)
 102   1      
 103   1          fdisp((value / 100) % 10, 1); // ??
 104   1          fdisp((value / 10) % 10 + 10, 2); // ??
 105   1          fdisp((value / 1) % 10, 3); // ??
 106   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    460    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.54   MODE                                                                  04/02/2025 12:15:33 PAGE 3   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
