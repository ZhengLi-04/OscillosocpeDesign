C51 COMPILER V9.54   LED                                                                   04/01/2025 23:49:04 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE LED
OBJECT MODULE PLACED IN .\Objects\LED.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE LED.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\LED.l
                    -st) TABS(2) OBJECT(.\Objects\LED.obj)

line level    source

   1          #include <reg51.h>
   2          #include <math.h>
   3          #include <absacc.h>
   4          #include <intrins.h>
   5          
   6          #include "led.h"
   7          #include "global.h"
   8          
   9          //void dsptask()
  10          //{
  11          //    unsigned char i;
  12          //    unsigned char a, b;
  13          
  14          //    switch (sel)
  15          //    {
  16          //    case 0:
  17          //        a = 0x01;
  18          //        break;
  19          //    case 1:
  20          //        a = 0x02;
  21          //        break;
  22          //    case 2:
  23          //        a = 0x04;
  24          //        break;
  25          //    default:
  26          //        a = 0x08;
  27          //    }
  28          
  29          //    for (b = 0x80, i = 0; i < 8; i++)
  30          //    {
  31          //        D_SER = (a & b) ? 1 : 0;
  32          //        D_SRCLK = 0;
  33          //        D_SRCLK = 1;
  34          //        b = b >> 1;
  35          //    }
  36          
  37          //    a = dspbuf[sel];
  38          //    key_num = sel;
  39          //    sel++;
  40          //    if (sel >= 4) sel = 0;
  41          
  42          //    for (b = 0x80, i = 0; i < 8; i++)
  43          //    {
  44          //        D_SER = (a & b) ? 1 : 0;
  45          //        D_SRCLK = 0;
  46          //        D_SRCLK = 1;
  47          //        b = b >> 1;
  48          //    }
  49          
  50          //    D_RCLK = 0;
  51          //    D_RCLK = 1;
  52          //}
  53          
  54          void dsptask()
C51 COMPILER V9.54   LED                                                                   04/01/2025 23:49:04 PAGE 2   

  55          {
  56   1          unsigned char i;
  57   1          unsigned char a, b;
  58   1      
  59   1          // 第一部分：位选信号
  60   1          switch (sel)
  61   1          {
  62   2          case 0:
  63   2              a = 0x01;
  64   2              break;
  65   2          case 1:
  66   2              a = 0x02;
  67   2              break;
  68   2          case 2:
  69   2              a = 0x04;
  70   2              break;
  71   2          case 3:
  72   2              a = 0x08;
  73   2              break;
  74   2          case 4:
  75   2              a = 0x10;
  76   2              break;
  77   2          }
  78   1      
  79   1          // 位移输出位选信号
  80   1          for (b = 0x80, i = 0; i < 8; i++)
  81   1          {
  82   2              D_SER = (a & b) ? 1 : 0;
  83   2              D_SRCLK = 0;
  84   2              D_SRCLK = 1;
  85   2              b >>= 1;
  86   2          }
  87   1      
  88   1          // 第二部分：段选信号生成
  89   1          if (sel < 4)
  90   1          {
  91   2              // 正常数码管显示
  92   2              a = dspbuf[sel];
  93   2              key_num = sel;
  94   2          }
  95   1          else
  96   1          {
  97   2              // LED模式控制
  98   2              switch (workMode)
  99   2              {
 100   3              case MODE_1:
 101   3                  a = 0xF7;
 102   3                  break;
 103   3              case MODE_2:
 104   3                  a = 0xFB;
 105   3                  break;
 106   3              case MODE_3:
 107   3                  a = 0xFD;
 108   3                  break;
 109   3              default:
 110   3                  a = 0xFF;
 111   3              }
 112   2          }
 113   1      
 114   1          // 位移输出段选信号
 115   1          for (b = 0x80, i = 0; i < 8; i++)
 116   1          {
C51 COMPILER V9.54   LED                                                                   04/01/2025 23:49:04 PAGE 3   

 117   2              D_SER = (a & b) ? 1 : 0;
 118   2              D_SRCLK = 0;
 119   2              D_SRCLK = 1;
 120   2              b >>= 1;
 121   2          }
 122   1      
 123   1          // 锁存输出
 124   1          D_RCLK = 0;
 125   1          D_RCLK = 1;
 126   1          D_RCLK = 0;
 127   1      
 128   1          // 循环控制（数码管0-3，LED控制4）
 129   1          sel++;
 130   1          if (sel > 4) sel = 0;
 131   1      }
 132          
 133          
 134          void fdisp(unsigned char n, unsigned char m)
 135          {
 136   1          char  c;
 137   1          switch (n)
 138   1          {
 139   2          case 0:
 140   2              c = 0x11;
 141   2              break;
 142   2          case 1:
 143   2              c = 0x7d;
 144   2              break;
 145   2          case 2:
 146   2              c = 0x23;
 147   2              break;
 148   2          case 3:
 149   2              c = 0x29;
 150   2              break;
 151   2          case 4:
 152   2              c = 0x4d;
 153   2              break;
 154   2          case 5:
 155   2              c = 0x89;
 156   2              break;
 157   2          case 6:
 158   2              c = 0x81;
 159   2              break;
 160   2          case 7:
 161   2              c = 0x3d;
 162   2              break;
 163   2          case 8:
 164   2              c = 0x01;
 165   2              break;
 166   2          case 9:
 167   2              c = 0x09;
 168   2              break;
 169   2          default:
 170   2              c = 0xef;
 171   2          }
 172   1          dspbuf[m] = c;
 173   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    245    ----
   CONSTANT SIZE    =   ----    ----
C51 COMPILER V9.54   LED                                                                   04/01/2025 23:49:04 PAGE 4   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
